const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d");
let width,height;
function resize(){width=canvas.width=window.innerWidth;height=canvas.height=window.innerHeight;}
window.addEventListener("resize",resize);resize();

const goatImg=new Image(); goatImg.src="assets/goat.png";
const levelBg=[]; for(let i=1;i<=3;i++){ const img=new Image(); img.src=`assets/level${i}-bg.png`; levelBg.push(img); }
const music=[]; for(let i=1;i<=3;i++){ const audio=new Audio(`assets/music${i}.mp3`); audio.loop=true; music.push(audio); }

let currentLevel=0, score=0, highScore=parseInt(localStorage.getItem("goatHighScore")||0);
const thresholds=[1000,2000,3000], gravity=0.5, jumpStrength=-10;
let goat={ x:width/2, y:height/2, vy:0, width:50, height:50 };

canvas.addEventListener("touchstart",()=>{ goat.vy=jumpStrength; });

function startLevel(level){
  currentLevel=level; score=0;
  goat.x=width/2; goat.y=height/2;
  music.forEach((m,i)=> i===level ? m.play() : m.pause());
}

function update(){
  goat.vy+=gravity; goat.y+=goat.vy;
  if(goat.y+goat.height>height){ goat.y=height-goat.height; goat.vy=0; }
  if(goat.y<0){ goat.y=0; goat.vy=0; }
  score++;
  if(score>highScore){
    highScore=score;
    localStorage.setItem("goatHighScore", highScore);
  }
  if(score>thresholds[currentLevel] && currentLevel<thresholds.length-1){
    startLevel(currentLevel+1);
  }
}

function draw(){
  ctx.drawImage(levelBg[currentLevel],0,0,width,height);
  ctx.drawImage(goatImg, goat.x-goat.width/2, goat.y-goat.height/2, goat.width, goat.height);
  ctx.fillStyle="white";
  ctx.font="24px sans-serif";
  ctx.fillText(`Score: ${score}`, 10, 30);
  ctx.fillText(`High: ${highScore}`, 10, 60);
}

(function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
})();
